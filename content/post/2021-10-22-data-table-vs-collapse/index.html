---
title: 'R 包 data.table 与 collapse 比较'
author: 宇飞的世界
date: '2021-10-22'
output:
  html_document: default
slug: data-table-vs-collapse
categories:
  - R package
tags: [handle data]
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="前言" class="section level2">
<h2>前言</h2>
<p>当我知道 collapse 包时，我第一时间去 GitHub 上查看该项目。由于我长期使用 data.table 包处理数据，所以特别想知道他们之间的优劣势，通过查看基准测试，发现两个项目各有所长。由于我是一名零售行业数据分析师，需要的数据处理函数以及逻辑相对比较简单，接下来就两个 R 包在数据处理上的差异做简单的记录，主要比较相同的处理逻辑语法上的差异。</p>
<p>官方的手册中已有相关<a href="https://sebkrantz.github.io/collapse/articles/collapse_and_data.table.html">介绍</a>，可自行前往阅读。</p>
</div>
<div id="基础用法" class="section level2">
<h2>基础用法</h2>
<pre class="r"><code># 加载包
library(collapse)
library(data.table)
# 准备测试数据
# collapse data
df &lt;- readxl::read_excel(&#39;/Users/zhongyf/Desktop/datatable vs collapse.xlsx&#39;)
# data.table data
dt &lt;- readxl::read_excel(&#39;/Users/zhongyf/Desktop/datatable vs collapse.xlsx&#39;) |&gt; setDT()</code></pre>
<div id="行列选择" class="section level3">
<h3>行列选择</h3>
<p>列选择，新出来的数据处理框架基本都支持列名索引和数字索引的方式选择列，建议使用列名索引。</p>
<p>collapse 行列选择与tidyverse系列相似,支持列名索引以及数字索引。</p>
<ul>
<li>列选择</li>
</ul>
<ol style="list-style-type: decimal">
<li>collapse</li>
</ol>
<pre class="r"><code>df |&gt; fselect(BILL_DATE,POS_NO,SKU_NO,SHOP_NO,BILL_QTY) |&gt; head()
df |&gt; fselect(1:3,12) |&gt; head()</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>data.table</li>
</ol>
<pre class="r"><code>dt[,.(BILL_DATE,POS_NO,SKU_NO,SHOP_NO,BILL_QTY)] |&gt; head()
dt[,c(1:3,12)] |&gt; head()</code></pre>
<ul>
<li>子集(行选择)</li>
</ul>
<ol style="list-style-type: decimal">
<li>collapse</li>
</ol>
<pre class="r"><code># 筛选子集 行列同时
fsubset(df,SHOP_NO ==&quot;999842&quot; &amp; BILL_MONEY&gt;10,BILL_DATE,POS_NO,SKU_NO,SHOP_NO,BILL_QTY) |&gt; 
  head()</code></pre>
<p>简写方式, <code>sbt()</code>是的<code>fsubset()</code>简写。</p>
<pre class="r"><code>sbt(df,SHOP_NO ==&quot;999842&quot; &amp; BILL_MONEY&gt;10,BILL_DATE,POS_NO,SKU_NO,SHOP_NO,BILL_QTY) |&gt; 
  head()</code></pre>
<p>ss 是一种比 <code>dt[1:10, 2:3]</code>更快取子集的方式：</p>
<pre class="r"><code>ss(df,1:2,1:5)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>data.table</li>
</ol>
<pre class="r"><code>dt[SHOP_NO ==&quot;999842&quot; &amp; BILL_MONEY&gt;10,.(BILL_DATE,POS_NO,SKU_NO,SHOP_NO,BILL_QTY)] |&gt; 
  head()</code></pre>
<p>collapse 的列选择以及子集，集合了 tidyverse 中 dpblyr 和 data.table 的特性。</p>
</div>
<div id="重新排列行列" class="section level3">
<h3>重新排列行列</h3>
<ol style="list-style-type: decimal">
<li>collapse</li>
</ol>
<p>在 collapse 中<code>roworder</code>是一个类比<code>dplyr::arrange</code>的函数，按照作者说法是受到<code>data.table::setorder</code>启发的一个函数。</p>
<pre class="r"><code>roworder(df,SHOP_NO) |&gt; 
  ss(1:2,1:5)</code></pre>
<blockquote>
<p>除非数据已经排序，否则roworder创建数据框的副本</p>
</blockquote>
</div>
</div>
